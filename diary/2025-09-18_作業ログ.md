# Joint Space Visualizer 作業ログ（2025/09/18）

## 1. 概要
- 距離計算を VTK ベース（vtkDistancePolyDataFilter）へ全面移行し、安定性・省メモリ化。
- 表示/UI 周りを強化（色スケール固定、最小距離の表示、表示/不透明度コントロール、保存（DL）機能）。
- README を最終整備。GitHub へサブツリー分割でプッシュ完了。

## 2. 主な変更点
### 計算ロジック
- trimesh/rtree を廃止し、VTK の `vtkDistancePolyDataFilter` で距離スカラーを生成。
- 大規模メッシュ対策として `vtkQuadricDecimation`（Decimation Options）を適用可能に。
- 距離スカラー“Distance”（mm）から最小距離を算出し、UI に表示。

### カラーマップ/スケール
- カラーマップを固定 0–5mm へ。
  - 0–1.0 mm: Red（フラット）
  - 1.0–2.5 mm: Red→Yellow
  - 2.5–3.25 mm: Yellow→Green
  - 3.25–4.0 mm: Green→Blue
  - 4.0–5.0 mm: Blue（フラット）
- Display セクションに “Scale (fixed)” の説明ラベルを追加。

### UI/表示制御
- Inputs → Decimation Options → Apply → Display の順に再構成。
- Display に Result/Target/Source ごとの Show/Opacity を追加（即時反映）。
- Apply 後に最小距離（mm）を表示。
- 結果モデルの保存（Save Result…）を実装（VTP/VTK/PLY/STL）。
  - 注意: STL はスカラーを保持しないため、VTP 推奨。

### 不具合修正
- onEnableDecimation 未定義エラーを修正（チェックボックスの有効/無効連動）。
- Display の重なり／操作反映なしを修正（シグナル/スロットの明示化、初期同期）。
- UI ロード不具合（不正タグ）を過去に修正済み。

## 3. ドキュメント
- `JointSpaceVisualizer/README.md` 新規作成（英語）。
- ルート `README.md` を刷新（日本語）。
- Python の追加ライブラリは不要（VTK 標準のみ）。

## 4. Git/GitHub
- 親リポジトリから `JointSpaceVisualizer` 配下をサブツリー分割し、以下へプッシュ：
  - https://github.com/e-MARU-Circle/JointSpaceVisualizer.git （main）
- 以後の公開は同手順（subtree split → push）で同期可能。

## 5. 使い方（要点）
1) Maxilla/Mandible を選択（または Load…）
2) 重い場合は Decimation を有効化（80–95% 目安）
3) Apply を実行
4) Display で各モデルの Show/Opacity を調整、Scale/Min Distance を確認
5) 保存は “Save Result…”（VTP 推奨）

## 6. 既知の注意点
- 追加モジュールパスにリポジトリの“親ディレクトリ”を含めると旧版が混在する恐れ。`.../JointSpaceVisualizer` のみを指定。
- macOS の `NSOpenPanel` 警告は無害。

## 7. 変更ファイル（主要）
- JointSpaceVisualizer/JointSpaceVisualizer.py
- JointSpaceVisualizer/Resources/UI/JointSpaceVisualizer.ui
- JointSpaceVisualizer/README.md（新規）
- README.md（更新）

以上、本日の作業記録です。
